## é¡¹ç›®å®æˆ˜ï¼šå°†è´¹æ›¼ç‰©ç†è®²ä¹‰ç½‘é¡µåšæˆç”µå­ä¹¦



### é¡¹ç›®èƒŒæ™¯

è´¹æ›¼ç‰©ç†è®²ä¹‰å·²ç»åœ¨å…¬å¼€åœ¨ç½‘ä¸Šå¯ä»¥é˜…è¯»ã€‚æˆ‘æƒ³åœ¨`Kindle`ä¸Šçœ‹å®ƒã€‚ç„¶è€Œå› ä¸ºå®ƒæœ‰æŒºå¤šçš„æ•°å­¦å…¬å¼ã€‚å®ƒæœ€åˆçš„ç¨¿å­åº”è¯¥æ˜¯ç”¨`latex`åšçš„ã€‚å®ƒç”¨`mathjax`è¿™ä¸ªåº“æ¥æŠŠ`latex`æ ¼å¼çš„å†…å®¹æ˜¾ç¤ºåœ¨ç½‘é¡µä¸Šã€‚

ä¸¾ä¸ªä¾‹å­ã€‚

```html
<span class="MathJax_Preview" style="color: inherit; display: none;">
</span>
<div class="MathJax_Display">
    <span class="MathJax MathJax_FullWidth" id="MathJax-Element-10-Frame" tabindex="0" style="">
        <nobr>
            <span class="math" id="MathJax-Span-151" style="width: 100%; display: inline-block; min-width: 11.088em;">
                <span style="display: inline-block; position: relative; width: 100%; height: 0px; font-size: 106%; min-width: 11.088em;"><span style="position: absolute; clip: rect(3.069em, 1005.43em, 4.484em, -999.997em); top: -4.006em; left: 0em; width: 100%;"><span class="mrow" id="MathJax-Span-152"><span class="mtable" id="MathJax-Span-153" style="min-width: 11.088em;"><span style="display: inline-block; position: relative; width: 100%; height: 0px; min-width: 11.088em;"><span style="display: inline-block; position: absolute; width: 5.486em; height: 0px; clip: rect(-0.94em, 1005.43em, 0.475em, -999.997em); top: 0em; left: 50%; margin-left: -2.768em;"><span style="position: absolute; clip: rect(3.128em, 1005.43em, 4.484em, -999.997em); top: -4.006em; left: 0em;"><span style="display: inline-block; position: relative; width: 5.486em; height: 0px;"><span style="position: absolute; clip: rect(3.069em, 1005.43em, 4.425em, -999.997em); top: -4.006em; left: 50%; margin-left: -2.768em;"><span class="mtd" id="MathJax-Span-157"><span class="mrow" id="MathJax-Span-158"><span class="mi" id="MathJax-Span-159" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-160" style="font-family: MathJax_Math-italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.121em;"></span></span><span class="texatom" id="MathJax-Span-161"><span class="mrow" id="MathJax-Span-162"><span class="mo" id="MathJax-Span-163" style="font-family: MathJax_Main;">/</span></span></span><span class="mi" id="MathJax-Span-164" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-165" style="font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-166" style="font-family: MathJax_Main; padding-left: 0.298em;">=</span><span class="mi" id="MathJax-Span-167" style="font-family: MathJax_Math-italic; padding-left: 0.298em;">F<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.121em;"></span></span><span class="mi" id="MathJax-Span-168" style="font-family: MathJax_Math-italic;">v</span><span class="mo" id="MathJax-Span-169" style="font-family: MathJax_Main;">.</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span><span style="display: inline-block; position: absolute; width: 2.538em; height: 0px; clip: rect(-0.881em, 1002.48em, 0.475em, -999.997em); top: 0em; right: 0em; margin-right: 0em;"><span style="position: absolute; clip: rect(3.069em, 1002.48em, 4.425em, -999.997em); top: -4.006em; right: 0em;"><span class="mtd" id="mjx-eqn-EqI133"><span class="mrow" id="MathJax-Span-155"><span class="mtext" id="MathJax-Span-156" style="font-family: MathJax_Main;">(13.3)</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.253em;">
                </span>
            </span>
        </nobr>
    </span>
</div>
<script type="math/tex; mode=display" id="MathJax-Element-10">\begin{equation}
\label{Eq:I:13:3}
dT/dt = Fv.
\end{equation}
</script>
```

è¿™ä¸€å—`html`ä»£ç ä¸­ã€‚`script`æ ‡ç­¾ä¸‹æ˜¯`latex`çš„åŸæ ·æ–‡æœ¬ã€‚`mathjax`æŠŠå®ƒå˜æˆå¾ˆå¤šçš„`span`ã€‚æ¥æ˜¾ç¤ºå®ƒã€‚

æˆ‘ä»¬ç°åœ¨æœ‰ä¸ªæ€è·¯ã€‚å°±æ˜¯æŠŠ`mathjax`çš„æ˜¾ç¤ºæ–¹æ³•æ”¹æˆ`svg`å›¾ç‰‡ã€‚

ä» GitHub ä¸Šæ‰¾åˆ°ä¸€ä¸ªé¡¹ç›®`tuxu/latex2svg`ã€‚

```python
from latex2svg import latex2svg
out = latex2svg(r'\( e^{i \pi} + 1 = 0 \)')
print(out['depth'])
print(out['svg'])
```

è¯•ç€è¿è¡Œï¼Œä½†å‡ºé”™äº†ã€‚

```shell
    raise RuntimeError('latex not found')
RuntimeError: latex not found
```

çœ‹çœ‹ä»£ç ã€‚

```python
    # Run LaTeX and create DVI file
    try:
        ret = subprocess.run(shlex.split(params['latex_cmd']+' code.tex'),
                             stdout=subprocess.PIPE, stderr=subprocess.PIPE,
                             cwd=working_directory)
        ret.check_returncode()
    except FileNotFoundError:
        raise RuntimeError('latex not found')
```

åŸæ¥è¿™ä¹Ÿä¾èµ–äº`latex`å‘½ä»¤ã€‚

å®‰è£…ä¸€ä¸‹ã€‚

```shell
brew install --cask mactex
==> Caveats
You must restart your terminal window for the installation of MacTex CLI tools to take effect.
Alternatively, Bash and Zsh users can run the command:
  eval "$(/usr/libexec/path_helper)"
==> Downloading http://mirror.ctan.org/systems/mac/mactex/mactex-20200407.pkg
==> Downloading from https://mirrors.aliyun.com/CTAN/systems/mac/mactex/mactex-20200407.pkg
######################################################################## 100.0%
All formula dependencies satisfied.
==> Installing Cask mactex
==> Running installer for mactex; your password may be necessary.
installer: Package name is MacTeX
installer: choices changes file '/private/tmp/choices20210315-4643-5884ro.xml' applied
installer: Installing at base path /
installer: The install was successful.
ğŸº  mactex was successfully installed!
```

å®‰è£…æˆåŠŸã€‚

```shell
% latex
This is pdfTeX, Version 3.14159265-2.6-1.40.21 (TeX Live 2020) (preloaded format=latex)
 restricted \write18 enabled.
**
```

```python
out = latex2svg(r'\( e^{i \pi} + 1 = 0 \)')
print(out['depth'])
print(out['svg'])

svg = open('1.svg', 'w')
svg.write(out['svg'])
svg.close()
```

å¯ä»¥ç”Ÿæˆ`svg`äº†ã€‚

æ‰€ä»¥è¯•è¯•æŠŠ`mathjax`ä¸­å¾—åˆ°çš„`latex`æ–‡æœ¬éƒ½ç”Ÿæˆä¸€ä¸‹ã€‚

```python
from bs4 import BeautifulSoup
from latex2svg import latex2svg

file = open('The Feynman Lectures on Physics Vol. I Ch. 13_ Work and Potential Energy (A).html')
content = file.read()

soup = BeautifulSoup(content)

mathjaxs = soup.findAll('script', {'type': 'math/tex'})
for mathjax in mathjaxs:
    print(mathjax.string)
    out = latex2svg(mathjax.string)
    print(out['svg'])
```

å¯æƒœå‡ºé”™äº†ã€‚

```python
    raise CalledProcessError(self.returncode, self.args, self.stdout,
subprocess.CalledProcessError: Command '['latex', '-interaction', 'nonstopmode', '-halt-on-error', 'code.tex']' returned non-zero exit status 1.
```

å…·ä½“å“ªä¸ªå…¬å¼é”™äº†å‘¢ã€‚

```latex
\tfrac{1}{2}mv^2
```



## latex

æ¥å­¦ä¹ ä¸€ä¸‹`latex`ã€‚

```latex
\documentclass[12pt]{article}
\usepackage{lingmacros}
\usepackage{tree-dvips}
\begin{document}

\section*{Notes for My Paper}

Don't forget to include examples of topicalization.
They look like this:

{\small
\enumsentence{Topicalization from sentential subject:\\ 
\shortex{7}{a John$_i$ [a & kltukl & [el & 
  {\bf l-}oltoir & er & ngii$_i$ & a Mary]]}
{ & {\bf R-}clear & {\sc comp} & 
  {\bf IR}.{\sc 3s}-love   & P & him & }
{John, (it's) clear that Mary loves (him).}}
}

\subsection*{How to handle topicalization}

I'll just assume a tree structure like (\ex{1}).

{\small
\enumsentence{Structure of A$'$ Projections:\\ [2ex]
\begin{tabular}[t]{cccc}
    & \node{i}{CP}\\ [2ex]
    \node{ii}{Spec} &   &\node{iii}{C$'$}\\ [2ex]
        &\node{iv}{C} & & \node{v}{SAgrP}
\end{tabular}
\nodeconnect{i}{ii}
\nodeconnect{i}{iii}
\nodeconnect{iii}{iv}
\nodeconnect{iii}{v}
}
}

\subsection*{Mood}

Mood changes when there is a topic, as well as when
there is WH-movement.  \emph{Irrealis} is the mood when
there is a non-subject topic or WH-phrase in Comp.
\emph{Realis} is the mood when there is a subject topic
or WH-phrase.

\end{document}
```

ç½‘ä¸Šæ‰¾åˆ°ä¸€æ®µæ ·ä¾‹çš„`latex`æºç ã€‚

```shell
% latex code.tex
This is pdfTeX, Version 3.14159265-2.6-1.40.21 (TeX Live 2020) (preloaded format=latex)
 restricted \write18 enabled.
entering extended mode
(./code.tex
LaTeX2e <2020-02-02> patch level 5
L3 programming layer <2020-03-06>
(/usr/local/texlive/2020/texmf-dist/tex/latex/base/article.cls
Document Class: article 2019/12/20 v1.4l Standard LaTeX document class
(/usr/local/texlive/2020/texmf-dist/tex/latex/base/size12.clo))
(/usr/local/texlive/2020/texmf-dist/tex/latex/tree-dvips/lingmacros.sty)
(/usr/local/texlive/2020/texmf-dist/tex/latex/tree-dvips/tree-dvips.sty
tree-dvips version .91 of May 16, 1995
) (/usr/local/texlive/2020/texmf-dist/tex/latex/l3backend/l3backend-dvips.def)
(./code.aux) [1] (./code.aux) )
Output written on code.dvi (1 page, 3416 bytes).
Transcript written on code.log.
```

![latex](./img/latex.png)

æ¥å¯¹ç€æºç å’Œæ¸²æŸ“åçš„æ•ˆæœï¼Œçœ‹çœ‹èƒ½å­¦åˆ°ä»€ä¹ˆã€‚

```latex
\begin{document}
\end{document}
```

è¿™æ ·æ¥æŠŠæ–‡æ¡£è£¹èµ·æ¥ã€‚

```latex
\section*{Notes for My Paper}
```

è¿™è¡¨ç¤º`section`æ ‡é¢˜å¼€å¤´ã€‚

```latex
\subsection*{How to handle topicalization}
```

è¿™è¡¨ç¤ºå­æ ‡é¢˜ã€‚

```latex
\shortex{7}{a John$_i$ [a & kltukl & [el & 
  {\bf l-}oltoir & er & ngii$_i$ & a Mary]]}
```

![shortex](./img/shortex.png)

å¯è§`$_i$`æ¥è¡¨ç¤ºä¸‹æ ‡ã€‚`{\bf l-}`æ¥è¡¨ç¤ºåŠ ç²—ã€‚

```latex
\enumsentence{Structure of A$'$ Projections:\\ [2ex]
\begin{tabular}[t]{cccc}
    & \node{i}{CP}\\ [2ex]
    \node{ii}{Spec} &   &\node{iii}{C$'$}\\ [2ex]
        &\node{iv}{C} & & \node{v}{SAgrP}
\end{tabular}
\nodeconnect{i}{ii}
\nodeconnect{i}{iii}
\nodeconnect{iii}{iv}
\nodeconnect{iii}{v}
}
```

<img src="./img/node.png" alt="node" style="zoom:50%;" />

æ³¨æ„åˆ°`nodeconnect`æ¥è¡¨ç¤ºè¿çº¿ã€‚



### ç»§ç»­é¡¹ç›®

```latex
\documentclass[16pt]{article}
\usepackage{amsmath}
\begin{document}

\[\tfrac{1}{2}mv^2\]

\end{document}
```

<img src="./img/frac.png" alt="frac" style="zoom:50%;" />

è¿™æ ·å¯ä»¥æ­£ç¡®åœ°è¢«æ¸²æŸ“ã€‚åœ¨ä»£ç é‡Œæ— æ³•è¢«æ¸²æŸ“ï¼Œå¯èƒ½æ˜¯å› ä¸ºæ²¡æœ‰åŠ ä¸Š`\usepackage{amsmath}`ã€‚

```latex
\documentclass[12pt,preview]{standalone}

\usepackage[utf8x]{inputenc}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{newtxtext}
\usepackage[libertine]{newtxmath}

\begin{document}
\begin{preview}
\tfrac{1}{2}mv^2
\end{preview}
\end{document}
```

```shell
! Missing $ inserted.
<inserted text>
                $
l.12 \tfrac{1}{2}
                 mv^2
```

è¿™æ ·å‡ºé”™äº†ã€‚è€Œæ”¹æˆä¸€ä¸‹è¿™æ ·å°±å¯ä»¥ã€‚

```latex
\[\tfrac{1}{2}mv^2\]
```

è¿›è¡Œå„ç§è¯•æ¢ã€‚

```python
from bs4 import BeautifulSoup
from latex2svg import latex2svg

file = open('The Feynman Lectures on Physics Vol. I Ch. 13_ Work and Potential Energy (A).html')
content = file.read()

soup = BeautifulSoup(content, features="lxml")

mathjaxs = soup.findAll('script', {'type': 'math/tex'})
for mathjax in mathjaxs:
    print(mathjax.string)
    wrap = '$' + mathjax.string + '$'
    # if 'frac' in mathjax.string:
    #     wrap = '$' + mathjax.string + '$'
    if 'FLP' in mathjax.string:
        continue
    elif 'Fig' in mathjax.string:
        continue
    elif 'eps' in mathjax.string:
        continue
    out = latex2svg(wrap)
    # print(out)
    node = BeautifulSoup(out['svg'], features="lxml")
    svg = node.find('svg')
    mathjax.insert_after(svg)
    # print(out['svg'])
    # break
    # mathjax.replaceWith(out['svg'])    
    
    # print(dir(mathjax))
    # break
    
    # out = latex2svg(wrap)    
    # print(out['svg'])

# print(len(soup.contents))
    
output_file = open('out.html', 'w')
output_file.write(soup.prettify())
output_file.close()
# print(soup.contents)

# out = latex2svg(r'\( e^{i \pi} + 1 = 0 \)')
# print(out['depth'])
# print(out['svg'])

# svg = open('1.svg', 'w')
# svg.write(out['svg'])
# svg.close()

```

